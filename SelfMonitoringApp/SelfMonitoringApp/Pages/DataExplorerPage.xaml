<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             NavigationPage.HasNavigationBar="True"
             Title="View Data"
             xmlns:controls="clr-namespace:SelfMonitoringApp.Controls"
             x:Class="SelfMonitoringApp.Pages.DataExplorerPage">
    <ContentPage.Content>

        <StackLayout Margin="0,8,0,0">

            <!--Filter frame-->
            <Frame Padding="3" Margin="3">
                <StackLayout>
                    <Grid IsVisible="True" HeightRequest="40" Padding="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Label Text="Toggle Filter visibility" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                        <Switch x:Name="ShowFilterSwitch" Grid.Column="1" HorizontalOptions="Center" />
                    </Grid>

                    <Grid Padding="0" VerticalOptions="CenterAndExpand" HeightRequest="180" IsVisible="{Binding Source={x:Reference ShowFilterSwitch}, Path=IsToggled}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>

                        <controls:HeaderBlock Padding="0" HeaderText="Start Date">
                            <Frame BackgroundColor="White" Padding="0" Margin="5">
                                <DatePicker HorizontalOptions="Center" Grid.Row="1" Date="{Binding StartDate}" TextColor="Black"/>
                            </Frame>
                        </controls:HeaderBlock>

                        <controls:HeaderBlock Padding="0" Grid.Column="1" HeaderText="End Date">
                            <Frame BackgroundColor="White" Padding="0" Margin="5">
                                <DatePicker HorizontalOptions="Center"  Date="{Binding EndDate}" TextColor="Black" />
                            </Frame>
                        </controls:HeaderBlock>
                    </Grid>
                </StackLayout>
            </Frame>

            <!--Item Carousel-->
            <CarouselView BackgroundColor="White" ItemsSource="{Binding DaySummaries}" Margin="3">
                <CarouselView.ItemTemplate>
                    <DataTemplate>
                        <controls:HeaderBlock HorizontalOptions="CenterAndExpand" HeaderText="{Binding Date}">

                            <ScrollView>
                                <StackLayout>
                                    
                                    <!--Mood Frame-->
                                    <Frame Padding="2" Margin="8" HeightRequest="300">
                                        <StackLayout>
                                            <Label Text="Mood Logs" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" BackgroundColor="{StaticResource Secondary}"/>
                                            
                                            <!--Column Titles -->
                                            <Grid HeightRequest="100">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition/>
                                                    <ColumnDefinition/>
                                                </Grid.ColumnDefinitions>
                                                <Label Text="Time" HorizontalOptions="Center"/>
                                                <Label Grid.Column="1" Text="Rating" HorizontalTextAlignment="Center"/>
                                                <Label Grid.Column="2" Text="Emotions" HorizontalOptions="Center"/>
                                            </Grid>
                                            
                                            <!--Mood Collection List View-->
                                            <ListView ItemsSource="{Binding Moods}" SeparatorColor="Black" BackgroundColor="LightGray" Margin="5">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <ViewCell Height="60">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="80"/>
                                                                    <ColumnDefinition/>
                                                                    <ColumnDefinition/>
                                                                </Grid.ColumnDefinitions>
                                                                <Label Text="{Binding RegisteredTime, StringFormat='{0:hh:mm tt}'}" HorizontalTextAlignment="Center" TextColor="Black" VerticalTextAlignment="Center"/>
                                                                <Label Text="{Binding OverallMood}" Grid.Column="1" HorizontalTextAlignment="Center" FontAttributes="Bold" VerticalTextAlignment="Center" TextColor="Black"/>
                                                                <CollectionView ItemsSource="{Binding Emotions}" Grid.Column="2" FlowDirection="LeftToRight" />
                                                            </Grid>
                                                        </ViewCell>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                            </ListView>
                                            
                                            <!--Edit Delete Buttons-->
                                            <Grid HeightRequest="160" Padding="0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition/>
                                                    <ColumnDefinition/>
                                                </Grid.ColumnDefinitions>
                                                <Button Text="Edit" Style="{StaticResource ButtonStyle}" Margin="0"/>
                                                <Button Grid.Column="1" Text="Delete" Style="{StaticResource ButtonStyle}" Margin="0"/>
                                            </Grid>
                                        </StackLayout>
                                    </Frame>

                                    <!--Meal Frame-->
                                    <Frame Padding="2" Grid.Row="2" Margin="8" HeightRequest="300">
                                        <StackLayout>
                                            <Label Text="Meal Logs" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" BackgroundColor="{StaticResource Secondary}"/>

                                            <!--Column Titles -->
                                            <Grid HeightRequest="100">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="40"/>
                                                    <ColumnDefinition/>
                                                </Grid.ColumnDefinitions>
                                                <Label Text="Time" HorizontalOptions="Center"/>
                                                <Label Grid.Column="1" Text="Rating" HorizontalTextAlignment="Center"/>
                                                <Label Grid.Column="2" Text="Description" HorizontalTextAlignment="Center"/>
                                            </Grid>

                                            <!--Meal Collection View-->
                                            <ListView ItemsSource="{Binding Meals}" BackgroundColor="LightGray" Margin="5" SeparatorColor="Black">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <ViewCell>
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="80"/>
                                                                    <ColumnDefinition Width="40"/>
                                                                    <ColumnDefinition/>
                                                                </Grid.ColumnDefinitions>

                                                                <Label Text="{Binding RegisteredTime, StringFormat='{0:hh:mm tt}'}" HorizontalTextAlignment="Center" TextColor="Black" VerticalTextAlignment="Center"/>
                                                                <Label Text="{Binding Satisfaction}" HorizontalTextAlignment="Center" Grid.Column="1" TextColor="Black" FontAttributes="Bold" VerticalTextAlignment="Center"/>
                                                                <Label Text="{Binding Description}" Grid.Column="2" HorizontalTextAlignment="Center" FontAttributes="Bold" TextColor="Black" VerticalTextAlignment="Center"/>
                                                            </Grid>
                                                        </ViewCell>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                            </ListView>
                                            
                                            <!--Edit Delete Buttons-->
                                            <Grid HeightRequest="160" Padding="0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition/>
                                                    <ColumnDefinition/>
                                                </Grid.ColumnDefinitions>
                                                <Button Text="Edit" Style="{StaticResource ButtonStyle}" Margin="0"/>
                                                <Button Grid.Column="1" Text="Delete" Style="{StaticResource ButtonStyle}" Margin="0"/>
                                            </Grid>
                                        </StackLayout>
                                    </Frame>

                                    <!--Meal Frame-->
                                    <Frame Padding="2" Grid.Row="2" Margin="8" HeightRequest="160">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="30"/>
                                                <RowDefinition Height="30"/>
                                                <RowDefinition/>
                                                <RowDefinition Height="40"/>
                                            </Grid.RowDefinitions>
                                            <Label Text="Sleep Logs" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center" BackgroundColor="{StaticResource Secondary}"/>

                                            <!--Column Titles -->
                                            <Grid Grid.Row="1">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition/>
                                                </Grid.ColumnDefinitions>
                                                <Label Text="Sleep" VerticalTextAlignment="Center" HorizontalTextAlignment="Center"/>
                                                <Label Grid.Column="1" Text="Wake" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                                                <Label Grid.Column="2" Text="Total" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                                                <Label Grid.Column="3" Text="Rating" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                                            </Grid>

                                            <!--Sleep Collection View-->
                                            <ListView ItemsSource="{Binding Sleeps}" Grid.Row="2" BackgroundColor="LightGray">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <ViewCell>
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="80"/>
                                                                    <ColumnDefinition Width="80"/>
                                                                    <ColumnDefinition Width="40"/>
                                                                </Grid.ColumnDefinitions>

                                                                <Label Text="{Binding SleepStartDate, StringFormat='{0:hh:mm tt}'}" HorizontalTextAlignment="Center" TextColor="Black" VerticalTextAlignment="Center"/>
                                                                <Label Text="{Binding SleepEndDate, StringFormat='{0:hh:mm tt}'}" HorizontalTextAlignment="Center" TextColor="Black"  VerticalTextAlignment="Center" Grid.Column="1"/>
                                                                <Label Text="{Binding TotalSleep}" HorizontalTextAlignment="Center" TextColor="Black" Grid.Column="2"  VerticalTextAlignment="Center"/>
                                                                <Label Text="{Binding RestRating}" HorizontalTextAlignment="Center" TextColor="Black" Grid.Column="3"  VerticalTextAlignment="Center"/>
                                                            </Grid>
                                                        </ViewCell>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                            </ListView>

                                            <!--Edit Delete Buttons-->
                                            <Grid Padding="0" Grid.Row="3">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition/>
                                                    <ColumnDefinition/>
                                                </Grid.ColumnDefinitions>
                                                <Button Text="Edit" Style="{StaticResource ButtonStyle}" Margin="0"/>
                                                <Button Grid.Column="1" Text="Delete" Style="{StaticResource ButtonStyle}" Margin="0"/>
                                            </Grid>
                                        </Grid>
                                    </Frame>

                                </StackLayout>
                            </ScrollView>
                        </controls:HeaderBlock>
                    </DataTemplate>
                </CarouselView.ItemTemplate>
            </CarouselView>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>